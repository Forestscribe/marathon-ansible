---
- name: Deploy etc
  marathon:
    marathon_uri: "{{ marathon_uri }}"
    app_id: etc
    app_json:
        cpus: 0.5
        mem: 64
        disk: 0
        instances: 1
        container:
          type: DOCKER
          docker:
            image:  "forestscribe/zk-http-bridge"
            network: BRIDGE
            privileged: false
            parameters: []
            forcePullImage: false
            portMappings:
              - containerPort: 8080
                protocol: tcp
                servicePort: "{{ servicePorts['etc'] }}"
        env:
            http_proxy: "{{proxy_env['http_proxy']}}"
        labels:
          HAPROXY_GROUP: external
          HAPROXY_BIND_ADDR: 172.17.0.1

        healthChecks:
        -
          path: /
          protocol: HTTP
          portIndex: 0
          gracePeriodSeconds: 300
          intervalSeconds: 60
          timeoutSeconds: 20
          maxConsecutiveFailures: 3
          ignoreHttp1xx: false
